{% extends 'public/base.html' %}

{% block content %}
<style>
    .stats-header {
        background: linear-gradient(135deg, #2d5016 0%, #3d6b1f 100%);
        color: white;
        padding: 2rem;
        border-radius: 12px;
        margin-bottom: 2rem;
    }

    .stats-header h2 {
        margin: 0;
        font-size: 1.8rem;
    }

    .stats-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
        gap: 1.5rem;
        margin: 2rem 0;
    }

    .chart-box {
        background: white;
        padding: 1.5rem;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        border: 1px solid #eee;
    }

    .chart-box h3 {
        margin: 0 0 1rem 0;
        color: #2d5016;
        font-size: 1.1rem;
    }

    .summary-box {
        background: linear-gradient(135deg, #2d5016 0%, #3d6b1f 100%);
        color: white;
        padding: 2rem;
        border-radius: 12px;
        margin: 2rem 0;
        box-shadow: 0 4px 12px rgba(45, 80, 22, 0.2);
    }

    .summary-box h3 {
        margin: 0 0 1.5rem 0;
        font-size: 1.3rem;
    }

    .summary-item {
        display: inline-block;
        margin: 0 2rem 1rem 0;
        font-size: 1rem;
    }

    .summary-item strong {
        display: block;
        font-size: 2rem;
        margin-bottom: 0.3rem;
        font-weight: 700;
    }

    .summary-item .label {
        display: block;
        font-size: 0.9rem;
        opacity: 0.95;
    }

    .details-table {
        width: 100%;
        border-collapse: collapse;
        margin: 2rem 0;
        background: white;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
    }

    .details-table th {
        background: #f5f5f5;
        color: #2d5016;
        padding: 1rem;
        text-align: left;
        font-weight: 600;
        border-bottom: 2px solid #ddd;
    }

    .details-table td {
        padding: 0.9rem 1rem;
        border-bottom: 1px solid #eee;
    }

    .details-table tr:hover {
        background: #fafafa;
    }

    .details-table tbody tr:last-child td {
        border-bottom: none;
    }
</style>

<div class="stats-header">
    <h2>üìä Tableau de bord - Statistiques</h2>
    <p>Vue d'ensemble de votre exploitation</p>
</div>

<div class="summary-box">
    <h3>üí∞ R√©sum√© financier</h3>
    <div class="summary-item">
        <strong>{{ revenu_total|floatformat:0 }}</strong>
        <span class="label">FCFA ‚Äî Revenu total</span>
    </div>
    <div class="summary-item">
        <strong>{{ depenses_total|floatformat:0 }}</strong>
        <span class="label">FCFA ‚Äî D√©penses totales</span>
    </div>
    <div class="summary-item">
        <strong {% if bilan>= 0 %}style="color: #90EE90;"{% else %}style="color: #FFB6C6;"{% endif %}>{{
            bilan|floatformat:0 }}</strong>
        <span class="label">FCFA ‚Äî Bilan</span>
    </div>
</div>

<div class="stats-container">
    <div class="chart-box">
        <h3>üì¶ Production par l√©gumineuse</h3>
        <canvas id="productionChart"></canvas>
    </div>

    <div class="chart-box">
        <h3>üè™ Stock disponible</h3>
        <canvas id="stockChart"></canvas>
    </div>

    <div class="chart-box">
        <h3>üìà Ventes par l√©gumineuse</h3>
        <canvas id="ventesChart"></canvas>
    </div>
</div>

<h3 style="margin-top: 2rem; color: #2d5016;">üìã D√©tails par l√©gumineuse</h3>
<table class="details-table">
    <thead>
        <tr>
            <th>ü•¨ L√©gumineuse</th>
            <th style="text-align: right;">üì¶ Total r√©colte (kg)</th>
            <th style="text-align: right;">üè™ Stock (kg)</th>
            <th style="text-align: right;">üìà Total ventes (kg)</th>
        </tr>
    </thead>
    <tbody>
        {% for s in stats_legumineuses %}
        <tr>
            <td>{{ s.legumineuse }}</td>
            <td style="text-align: right;"><strong>{{ s.total_recolte }}</strong></td>
            <td style="text-align: right;">{{ s.stock }}</td>
            <td style="text-align: right;">{{ s.total_ventes }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<a href="/dashboard/" class="btn" style="margin-top: 2rem; display: inline-block;">‚¨Ö Retour au dashboard</a>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Donn√©es pour les graphiques
    const labels = JSON.parse('{{ labels|safe }}');
    const productionData = JSON.parse('{{ production_data|safe }}');
    const stockData = JSON.parse('{{ stock_data|safe }}');
    const ventesData = JSON.parse('{{ ventes_data|safe }}');
    const backgroundColors = JSON.parse('{{ background_colors|safe }}');

    // Configuration commune
    const chartConfig = {
        responsive: true,
        maintainAspectRatio: true,
        plugins: {
            legend: {
                display: true,
                position: 'top',
            },
        }
    };

    // Graphique Production
    new Chart(document.getElementById('productionChart'), {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: 'Production (kg)',
                data: productionData,
                backgroundColor: backgroundColors,
                borderColor: '#eee',
                borderWidth: 1
            }]
        },
        options: chartConfig
    });

    // Graphique Stock
    new Chart(document.getElementById('stockChart'), {
        type: 'doughnut',
        data: {
            labels: labels,
            datasets: [{
                label: 'Stock (kg)',
                data: stockData,
                backgroundColor: backgroundColors,
                borderColor: '#fff',
                borderWidth: 2
            }]
        },
        options: chartConfig
    });

    // Graphique Ventes
    new Chart(document.getElementById('ventesChart'), {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: 'Ventes (kg)',
                data: ventesData,
                borderColor: '#2d5016',
                backgroundColor: 'rgba(45, 80, 22, 0.1)',
                borderWidth: 3,
                fill: true,
                tension: 0.4,
                pointBackgroundColor: backgroundColors,
                pointRadius: 6
            }]
        },
        options: chartConfig
    });
</script>
{% endblock %}